<form script="runPageScript.js" theme="light">
  <label>MITRE ATT&amp;CK Framework</label>
  <description>Each number represents a piece of content. Follow the headlines 1, 2 and 3 to find and drill down into the content.</description>
  <init>
    <set token="chart_post_process">| lookup mitre_matrix_list "Tactic" AS "MITRE Tactic" OUTPUT Tactic_Order
| sort Tactic_Order
| fields - Tactic_Order</set>
    <set token="Phase0LongName">Active</set>
    <set token="Phase1LongName">Available</set>
    <set token="Phase2LongName">Needs data</set>
    <set token="SelectedLongName">Selected</set>
    <set token="SelectedColor">F1C40F</set>
    <set token="deeplink_highlight">Yes</set>
    <set token="colorby">Total</set>
  </init>
  <search>
    <query>| inputlookup ColorScheme.csv WHERE Enabled="Yes"
| appendcols [
| inputlookup AppSettings.csv
| transpose 10 header_field=Key
| fields - column
]</query>
    <done>
      <condition match="'job.resultCount' &gt; 0">
        <set token="addsample"></set>
        <set token="replacewithsample"></set>
        <set token="y_field">Status</set>
        <set token="Phase0Color">$result.Phase0$</set>
        <set token="Phase1Color">$result.Phase1$</set>
        <set token="Phase2Color">$result.Phase2$</set>
        <set token="SelectedColor">$result.Selected$</set>
        <set token="Phase0LongName">$result.Phase0LongName$</set>
        <set token="Phase0ShortName">$result.Phase0ShortName$</set>
        <set token="Phase1LongName">$result.Phase1LongName$</set>
        <set token="Phase1ShortName">$result.Phase1ShortName$</set>
        <set token="Phase2LongName">$result.Phase2LongName$</set>
        <set token="Phase2ShortName">$result.Phase2ShortName$</set>
        <set token="SelectedLongName">$result.SelectedLongName$</set>
        <set token="SelectedShortName">$result.SelectedShortName$</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| makeresults count=1</query>
    <done>
      <condition match="$job.doneProgress$=1">
        <set token="x_field">$form.x_field$</set>
        <set token="chart_post_process">|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$form.x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| rest splunk_server=local /services/apps/local | search disabled=0 title=*sankey*</query>
    <done>
      <condition match="'job.resultCount' == 0">
        <set token="nosankey">nosankey</set>
        <unset token="sankey">sankey</unset>
      </condition>
      <condition match="'job.resultCount' &gt; 0">
        <unset token="nosankey">nosankey</unset>
        <set token="sankey">sankey</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| rest splunk_server=local /services/apps/local | search disabled=0 title=*radar*</query>
    <done>
      <condition match="'job.resultCount' == 0">
        <set token="noradar">noradar</set>
        <unset token="radar">radar</unset>
      </condition>
      <condition match="'job.resultCount' &gt; 0">
        <unset token="noradar">noradar</unset>
        <set token="radar">radar</set>
      </condition>
    </done>
  </search>
  <search id="usecase_base">
    <query>
        | sseanalytics
        | lookup use_cases.csv title AS "usecase" OUTPUT order_title AS use_case_order_title
        | eval "Use Case Orig"=if(isnull('usecase'),"Other",'usecase')
        | eval "Use Case"=if(isnull(use_case_order_title), "9_Other",use_case_order_title)
        | eval "Has Data"=if(data_available="Good" OR data_available="Mixed", "Yes", "No")
        | eval Status=case(
        'enabled'="Yes" AND 'Has Data'="Yes","$Phase0LongName$",
        'enabled'!="Yes" AND 'Has Data'="Yes","$Phase1LongName$",
        1=1,"$Phase2LongName$"
        )
        | eval App=displayapp, Enabled=enabled, Title=name, Journey=journey, "Data Source"=datasource, "Data Source Category"=data_source_categories_display
        | where (mitre_tactic_display!="" AND mitre_tactic_display!="None") OR (mitre_technique_display!="" AND mitre_technique_display!="None" AND mvcount(mitre_technique_display)&gt;0)
        | eval "MITRE Tactic"=if('mitre_tactic_display'="","-",'mitre_tactic_display'), "MITRE Technique"=mitre_technique_display
</query>
  </search>
  <search base="usecase_base">
    <query>
      | table "MITRE Tactic" "MITRE Technique" Status
| mvexpand "MITRE Tactic"
| mvexpand "MITRE Technique"
| eventstats count AS MITRE_Tactic_Total BY "MITRE Tactic" 
| eventstats count AS MITRE_Technique_Total BY "MITRE Technique"
| eventstats count AS MITRE_Tactic_Technique_Total BY "MITRE Tactic" "MITRE Technique"
| stats 
sum(eval(if(Status="$Phase0LongName$",1,0))) AS "$Phase0LongName$",
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
max(MITRE_Tactic_Total) AS MITRE_Tactic_Total,
max(MITRE_Technique_Total) AS MITRE_Technique_Total
max(MITRE_Tactic_Technique_Total) AS MITRE_Tactic_Technique_Total
BY "MITRE Tactic","MITRE Technique"
| rename "MITRE *" AS *,"MITRE_*" AS *
| table Tactic Tactic_Total Technique Technique_Total $Phase0LongName$ "$Phase1LongName$" "$Phase2LongName$" Technique_Total
| outputlookup mitre_environment_count.csv
    </query>
  </search>
  <fieldset submitButton="false"></fieldset>
  <row>
    <panel>
      <html>
          <i data-translate-id="contentanalytics-i-mitrelink">For more details check the <a href="https://mitre-attack.github.io/attack-navigator/enterprise/" target="_blank">MITRE ATT&amp;CK Navigator.</a>
        </i>
  
      </html>
    </panel>
  </row>
  <row id="cs2">
    <panel>
      <single>
        <title>$Phase0LongName$</title>
        <search base="usecase_base">
          <query>| where Status="$Phase0LongName$"
| stats count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="rangeColors">["#$Phase0Color$","#3c444d"]</option>
        <option name="rangeValues">[1000]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Content ($Phase0LongName$)</option>
        <option name="useColors">1</option>
        <drilldown>
          <set token="form.phase">$Phase0LongName$</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <single>
        <title>$Phase1LongName$</title>
        <search base="usecase_base">
          <query>| where Status="$Phase1LongName$"
| stats count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="rangeColors">["#$Phase1Color$","#3c444d"]</option>
        <option name="rangeValues">[1000]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Content ($Phase1LongName$)</option>
        <option name="useColors">1</option>
        <drilldown>
          <set token="form.phase">$Phase1LongName$</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <single>
        <title>$Phase2LongName$</title>
        <search base="usecase_base">
          <query>| where Status="$Phase2LongName$"
| stats count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="rangeColors">["#$Phase2Color$","#3c444d"]</option>
        <option name="rangeValues">[10000]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Content ($Phase2LongName$)</option>
        <option name="useColors">1</option>
        <drilldown>
          <set token="form.phase">$Phase2LongName$</set>
        </drilldown>
      </single>
    </panel>
  </row>
  <row id="tabs">
    <panel>
      <html>
      <h1 data-translate-id="contentanalytics-h1-availableContent">1. Available Content</h1>
          <p data-translate-id="contentanalytics-p-graphs">Click in the graphs below to filter on an area you want to highlight. </p>
      <ul id="tabs" class="nav nav-tabs">
                    <li class="active">
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row1_col1,row2_col1" data-token="row1_col1" data-translate-id="contentanalytics-li-chartview">Chart View</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row1_col2,row2_col1" data-token="row1_col2" data-translate-id="contentanalytics-li-radarview">Radar View</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row1_col3,row2_col1" data-token="row1_col3" data-translate-id="contentanalytics-li-sankeyview">Sankey View</a>
                    </li>
          <li>
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row1_col4,row1_col5,row1_col6,row1_col7,row2_col1" data-token="row1_col4" data-translate-id="contentanalytics-li-journeyview">Security Journey View</a>
                    </li>
                              <li>
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row1_col8,row2_col1" data-token="row1_col8" data-translate-id="contentanalytics-li-mitremapview">MITRE Map View</a>
                    </li>
				</ul>


    </html>
    </panel>
  </row>
  <row id="row1_col1">
    <panel>
      <input type="dropdown" token="x_field">
        <label>Split by</label>
        <choice value="App">App</choice>
        <choice value="Data Source">Data Source</choice>
        <choice value="Data Source Category">Data Source Category</choice>
        <choice value="Use Case">Use Case</choice>
        <choice value="Journey">Journey</choice>
        <choice value="MITRE Tactic">MITRE Tactic</choice>
        <choice value="MITRE Technique">MITRE Technique</choice>
        <default>MITRE Tactic</default>
        <change>
          <condition label="Use Case">
            <set token="chart_post_process">| append
[
| inputlookup use_cases.csv
| fields title order_title
| rename order_title AS "Use Case"
]
| stats first(*) AS * BY "Use Case"
| fields - "Use Case"
| rename title AS "Use Case"
| fillnull
|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</set>
          </condition>
          <condition label="MITRE Tactic">
            <set token="chart_post_process">| lookup mitre_matrix_list "Tactic" AS "MITRE Tactic" OUTPUT Tactic_Order
| sort Tactic_Order
| fields - Tactic_Order</set>
          </condition>
          <condition label="MITRE Technique">
            <set token="chart_post_process">| lookup mitre_matrix_list "Technique" AS "MITRE Technique" OUTPUT Technique_Order
| sort Technique_Order
| fields - Technique_Order</set>
          </condition>
          <condition label="*">
            <set token="chart_post_process">|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</set>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="phase">
        <label>Status</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <fieldForLabel>LongName</fieldForLabel>
        <fieldForValue>LongName</fieldForValue>
        <search>
          <query>| inputlookup AppSettings.csv
| rex field=Key "(?&lt;phase&gt;.*)(Long|Short)Name"
| stats first(Value) AS LongName, Last(Value) AS ShortName BY phase
| fields - phase</query>
        </search>
      </input>
      <input type="dropdown" token="highlight">
        <label>Featured</label>
        <choice value="*">All</choice>
        <default>Yes</default>
        <initialValue>*</initialValue>
        <fieldForLabel>highlight</fieldForLabel>
        <fieldForValue>highlight</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by highlight | fields highlight | sort 0 highlight</query>
        </search>
      </input>
      <input type="multiselect" token="datasource_selection">
        <label>Data Source selection</label>
        <fieldForLabel>datasource</fieldForLabel>
        <fieldForValue>datasource</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by datasource | fields datasource | sort 0 datasource</query>
        </search>
        <choice value="*">None</choice>
        <default>*</default>
        <valuePrefix>"</valuePrefix>
        <delimiter>,</delimiter>
        <valueSuffix>"</valueSuffix>
      </input>
      <chart>
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "highlight"="$highlight$"
| chart count over "$x_field$" By Status

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

$chart_post_process$</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsY.majorUnit">1</option>
        <option name="charting.axisTitleY.text">Use Cases</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <eval token="form.enabled">if($form.y_field$="Enabled" OR $form.y_field$="Enabled and Accelerated", $click.name2$,"*")</eval>
          <eval token="form.status">$click.name2$</eval>
          <eval token="form.phase">$click.name2$</eval>
          <eval token="form.sourcetype">if($form.x_field$="Sourcetype", $click.value$,"*")</eval>
          <eval token="form.datamodel">if($form.x_field$="Datamodel", $click.value$,"*")</eval>
          <eval token="form.AddOn">if($form.x_field$="AddOn", $click.value$,"*")</eval>
          <eval token="form.App">if($form.x_field$="App", $click.value$,"*")</eval>
          <eval token="form.usecase">if($form.x_field$="Use Case", $click.value$,"*")</eval>
          <eval token="form.datasource">if($form.x_field$="Data Source", $click.value$,"*")</eval>
          <eval token="form.datacategory">if($form.x_field$="Data Source Category", $click.value$,"*")</eval>
          <eval token="form.journey">if($form.x_field$="Journey", $click.value$,"*")</eval>
          <eval token="form.MITRE_Tactic">if($form.x_field$="MITRE Tactic", $click.value$,"*")</eval>
          <eval token="form.MITRE_Technique">if($form.x_field$="MITRE Technique", $click.value$,"*")</eval>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row id="row1_col2">
    <panel depends="$radar$">
      <input type="dropdown" token="x_field">
        <label>Split by</label>
        <choice value="App">App</choice>
        <choice value="Data Source">Data Source</choice>
        <choice value="Use Case">Use Case</choice>
        <choice value="Journey">Journey</choice>
        <choice value="MITRE Tactic">MITRE Tactic</choice>
        <choice value="MITRE Technique">MITRE Technique</choice>
        <default>MITRE Tactic</default>
        <change>
          <condition label="Use Case">
            <set token="chart_post_process">| append
[
| inputlookup use_cases.csv
| fields title order_title
| rename order_title AS "Use Case"
]
| stats first(*) AS * BY "Use Case"
| fields - "Use Case"
| rename title AS "Use Case"
| fillnull
|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</set>
          </condition>
          <condition label="*">
            <set token="chart_post_process">|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</set>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="highlight">
        <label>Featured</label>
        <choice value="*">All</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>highlight</fieldForLabel>
        <fieldForValue>highlight</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by highlight | fields highlight | sort 0 highlight</query>
        </search>
      </input>
      <input type="multiselect" token="datasource_selection">
        <label>Data Source selection</label>
        <fieldForLabel>datasource</fieldForLabel>
        <fieldForValue>datasource</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by datasource | fields datasource | sort 0 datasource</query>
        </search>
        <choice value="*">None</choice>
        <default>*</default>
        <valuePrefix>"</valuePrefix>
        <delimiter>,</delimiter>
        <valueSuffix>"</valueSuffix>
      </input>
      <viz type="custom-radar-chart-viz.radar_chart">
        <title>(Requires Radar Viz)</title>
        <search base="usecase_base">
          <query>
                | search "highlight"="$highlight$"
                | chart count over "$x_field$" By Status

                | eval "$SelectedLongName$_New"=case(isnotnull(datasource) AND in(datasource,$datasource_selection$), '$SelectedLongName$',isnotnull(datasource) AND NOT in(datasource,$datasource_selection$),0,1=1,'$SelectedLongName$')
                | eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
                | fields - m
                | eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, '$Phase2LongName$'+'$SelectedLongName$', '$Phase2LongName$')
                | rename "$SelectedLongName$_New" AS "$SelectedLongName$"

                $chart_post_process$
                | untable "$x_field$" key value
                | rename  "$x_field$" AS axis
                | eval keyColor=case(
                    key="$Phase0LongName$","#$Phase0Color$",
                    key="$Phase1LongName$","#$Phase1Color$",
                    key="$Phase2LongName$","#$Phase2Color$",
                    key="$SelectedLongName$","#$SelectedColor$"
                )</query>
        </search>
        <option name="custom-radar-chart-viz.radar_chart.areasOpacity">0.35</option>
        <option name="custom-radar-chart-viz.radar_chart.axesLabelFontColor">#737373</option>
        <option name="custom-radar-chart-viz.radar_chart.axesLegendFontColor">#000000</option>
        <option name="custom-radar-chart-viz.radar_chart.axesLineColor">#FFFFFF</option>
        <option name="custom-radar-chart-viz.radar_chart.chartHeight">500</option>
        <option name="custom-radar-chart-viz.radar_chart.chartWidth">500</option>
        <option name="custom-radar-chart-viz.radar_chart.circlesColor">#CDCDCD</option>
        <option name="custom-radar-chart-viz.radar_chart.circlesFillColor">#ffffff</option>
        <option name="custom-radar-chart-viz.radar_chart.circlesOpacity">0.1</option>
        <option name="custom-radar-chart-viz.radar_chart.format">.0f</option>
        <option name="custom-radar-chart-viz.radar_chart.fullScreen">0</option>
        <option name="custom-radar-chart-viz.radar_chart.isRounded">0</option>
        <option name="custom-radar-chart-viz.radar_chart.legendEnabled">1</option>
        <option name="custom-radar-chart-viz.radar_chart.legendFontColor">#000000</option>
        <option name="custom-radar-chart-viz.radar_chart.legendPositionX">25</option>
        <option name="custom-radar-chart-viz.radar_chart.legendPositionY">25</option>
        <option name="custom-radar-chart-viz.radar_chart.legendSymbol">cross</option>
        <option name="custom-radar-chart-viz.radar_chart.legendToggleSymbol">circle</option>
        <option name="custom-radar-chart-viz.radar_chart.levels">10</option>
        <option name="custom-radar-chart-viz.radar_chart.maxValue"></option>
        <option name="drilldown">none</option>
        <option name="height">466</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
  <row id="row1_col3">
    <panel depends="$sankey$">
      <title>Content from App &gt; Data Source &gt; MITRE Tactic &gt; Status</title>
      <input type="dropdown" token="phase">
        <label>Status</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <fieldForLabel>LongName</fieldForLabel>
        <fieldForValue>LongName</fieldForValue>
        <search>
          <query>| inputlookup AppSettings.csv
| rex field=Key "(?&lt;phase&gt;.*)(Long|Short)Name"
| stats first(Value) AS LongName, Last(Value) AS ShortName BY phase
| fields - phase</query>
        </search>
      </input>
      <input type="dropdown" token="highlight">
        <label>Featured</label>
        <choice value="*">All</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>highlight</fieldForLabel>
        <fieldForValue>highlight</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by highlight | fields highlight | sort 0 highlight</query>
        </search>
      </input>
      <input type="multiselect" token="datasource_selection">
        <label>Data Source selection</label>
        <fieldForLabel>datasource</fieldForLabel>
        <fieldForValue>datasource</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by datasource | fields datasource | sort 0 datasource</query>
        </search>
        <choice value="*">None</choice>
        <default>*</default>
        <valuePrefix>"</valuePrefix>
        <delimiter>,</delimiter>
        <valueSuffix>"</valueSuffix>
      </input>
      <viz type="sankey_diagram_app.sankey_diagram">
        <title>(Requires Sankey Viz)</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| eval "Use Case"='Use Case Orig'
               | foreach Enabled Hosts "Data Source" App "Data Source" "MITRE Tactic" Status  [
             | eval "&lt;&lt;FIELD&gt;&gt;"=coalesce('&lt;&lt;FIELD&gt;&gt;',"-")
            ]
            | search Status="$phase$"
            | appendpipe [| stats count(eval('$y_field$'="$Phase1LongName$")) AS "$y_field$_l1", count AS l1 by App "Data Source"]
| appendpipe [| stats count(eval('$y_field$'="$Phase1LongName$")) AS "$y_field$_l2", count AS l2 by "Data Source" "MITRE Tactic"]
| appendpipe [| stats count(eval('$y_field$'="$Phase1LongName$")) AS "$y_field$_l3", count AS l3 by "MITRE Tactic" "$y_field$"]
| table App "Data Source" "MITRE Tactic" "$y_field$" l1 l2 l3 "$y_field$_l1" "$y_field$_l2" "$y_field$_l3"
| eval LinkSource=case(isnotnull(l1), App, isnotnull(l2), 'Data Source', isnotnull(l3), 'MITRE Tactic', 1=1,null)
| eval LinkDestination=case(isnotnull(l1), 'Data Source', isnotnull(l2), 'MITRE Tactic', isnotnull(l3), '$y_field$', 1=1,null)
| eval count=coalesce(l1,l2,l3)
| where isnotnull(l1) OR isnotnull(l2) OR isnotnull(l3)
| table LinkSource LinkDestination count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="sankey_diagram_app.sankey_diagram.colorMode">sequential</option>
        <option name="sankey_diagram_app.sankey_diagram.maxColor">#$Phase0Color$</option>
        <option name="sankey_diagram_app.sankey_diagram.minColor">#F5F8F6</option>
        <option name="sankey_diagram_app.sankey_diagram.numOfBins">9</option>
        <option name="sankey_diagram_app.sankey_diagram.showLegend">true</option>
        <option name="sankey_diagram_app.sankey_diagram.useColors">true</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
  <row id="row1_col4">
    <panel>
      <title>Security Journey</title>
      <input type="checkbox" token="show_recommended_only" searchWhenChanged="true">
        <label>Show</label>
        <choice value="AND highlight=&quot;Yes&quot; AND bookmark_status!=&quot;none&quot;">Bookmarked and Featured</choice>
        <change>
          <eval token="show_recommended_only">if(isnull($form.show_recommended_only$) OR $form.show_recommended_only$="", " ",$form.show_recommended_only$)</eval>
        </change>
        <default>"AND highlight=""Yes"" AND bookmark_status!=""none"""</default>
        <delimiter> </delimiter>
      </input>
    </panel>
  </row>
  <row id="row1_col5">
    <panel>
      <title>Stage 1</title>
      <chart id="stage_1_bar">
        <search base="usecase_base" id="stage_1_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_1" $show_recommended_only$
| chart count over Journey by Status
| table Journey Active Available "Needs data"
| fillnull Journey Active Available "Needs data"
| eval Perc_Active=round((Active/(Active+Available+'Needs data'))*100,2)
| eval Perc_Available=round((Available/(Active+Available+'Needs data'))*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 2</title>
      <chart id="stage_2_bar">
        <search base="usecase_base" id="stage_2_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_2" $show_recommended_only$
| chart count over Journey by Status
| table Journey Active Available "Needs data"
| fillnull Journey Active Available "Needs data"
| eval Perc_Active=round((Active/(Active+Available+'Needs data'))*100,2)
| eval Perc_Available=round((Available/(Active+Available+'Needs data'))*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 3</title>
      <chart id="stage_3_bar">
        <search base="usecase_base" id="stage_3_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_3" $show_recommended_only$
| chart count over Journey by Status
| table Journey Active Available "Needs data"
| fillnull Journey Active Available "Needs data"
| eval Perc_Active=round((Active/(Active+Available+'Needs data'))*100,2)
| eval Perc_Available=round((Available/(Active+Available+'Needs data'))*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 4</title>
      <chart id="stage_4_bar">
        <search base="usecase_base" id="stage_4_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_4" $show_recommended_only$
| chart count over Journey by Status
| table Journey Active Available "Needs data"
| fillnull Journey Active Available "Needs data"
| eval Perc_Active=round((Active/(Active+Available+'Needs data'))*100,2)
| eval Perc_Available=round((Available/(Active+Available+'Needs data'))*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 5</title>
      <chart id="stage_5_bar">
        <search base="usecase_base" id="stage_5_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_5" $show_recommended_only$
| chart count over Journey by Status
| table Journey Active Available "Needs data"
| fillnull Journey Active Available "Needs data"
| eval Perc_Active=round((Active/(Active+Available+'Needs data'))*100,2)
| eval Perc_Available=round((Available/(Active+Available+'Needs data'))*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 6</title>
      <chart id="stage_6_bar">
        <search base="usecase_base" id="stage_6_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_6" $show_recommended_only$
| chart count over Journey by Status
| table Journey Active Available "Needs data"
| fillnull Journey Active Available "Needs data"
| eval Perc_Active=round((Active/(Active+Available+'Needs data'))*100,2)
| eval Perc_Available=round((Available/(Active+Available+'Needs data'))*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row id="row1_col6">
    <panel>
      <single>
        <search base="stage_1_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_2_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_3_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_4_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_5_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_6_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
    </panel>
  </row>
  <row id="row1_col7">
    <panel>
      <single>
        <search base="stage_1_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_2_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_3_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_4_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_5_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_6_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
    </panel>
  </row>
  <row id="row1_col8">
    <panel>
      <input type="dropdown" token="colorby">
        <label>Color by</label>
        <choice value="Total">Total</choice>
        <default>Total</default>
        <fieldForLabel>Value</fieldForLabel>
        <fieldForValue>Value</fieldForValue>
        <search>
          <query>| inputlookup AppSettings.csv
| search Key=Phase*LongName
| fields Value</query>
        </search>
      </input>
      <table id="mitremaptable">
        <title>MITRE Map</title>
        <search>
          <query>| mitremap 
| foreach * 
    [| eval "&lt;&lt;FIELD&gt;&gt; Tactic" = "&lt;&lt;FIELD&gt;&gt;"
        ] 
| lookup mitre_environment_count.csv Technique AS "Initial Access", "Tactic" AS "Initial Access Tactic" OUTPUT "$Phase0LongName$" AS c1_1 "$Phase1LongName$" AS c1_2 "$Phase2LongName$" AS c1_3
| lookup mitre_environment_count.csv Technique AS "Execution", "Tactic" AS "Execution Tactic" OUTPUT "$Phase0LongName$" AS c2_1 "$Phase1LongName$" AS c2_2 "$Phase2LongName$" AS c2_3 
| lookup mitre_environment_count.csv Technique AS "Persistence", "Tactic" AS "Persistence Tactic" OUTPUT "$Phase0LongName$" AS c3_1 "$Phase1LongName$" AS c3_2 "$Phase2LongName$" AS c3_3 
| lookup mitre_environment_count.csv Technique AS "Privilege Escalation", "Tactic" AS "Privilege Escalation Tactic" OUTPUT "$Phase0LongName$" AS c4_1 "$Phase1LongName$" AS c4_2 "$Phase2LongName$" AS c4_3 
| lookup mitre_environment_count.csv Technique AS "Defense Evasion", "Tactic" AS "Defense Evasion Tactic" OUTPUT "$Phase0LongName$" AS c5_1 "$Phase1LongName$" AS c5_2 "$Phase2LongName$" AS c5_3 
| lookup mitre_environment_count.csv Technique AS "Credential Access", "Tactic" AS "Credential Access Tactic" OUTPUT "$Phase0LongName$" AS c6_1 "$Phase1LongName$" AS c6_2 "$Phase2LongName$" AS c6_3 
| lookup mitre_environment_count.csv Technique AS "Discovery", "Tactic" AS "Discovery Tactic" OUTPUT "$Phase0LongName$" AS c7_1 "$Phase1LongName$" AS c7_2 "$Phase2LongName$" AS c7_3 
| lookup mitre_environment_count.csv Technique AS "Lateral Movement", "Tactic" AS "Lateral Movement Tactic" OUTPUT "$Phase0LongName$" AS c8_1 "$Phase1LongName$" AS c7_2 "$Phase2LongName$" AS c8_3 
| lookup mitre_environment_count.csv Technique AS "Collection", "Tactic" AS "Collection Tactic" OUTPUT "$Phase0LongName$" AS c9_1 "$Phase1LongName$" AS c9_2 "$Phase2LongName$" AS c9_3 
| lookup mitre_environment_count.csv Technique AS "Exfiltration", "Tactic" AS "Exfiltration Tactic" OUTPUT "$Phase0LongName$" AS c10_1 "$Phase1LongName$" AS c10_2 "$Phase2LongName$" AS c10_3 
| lookup mitre_environment_count.csv Technique AS "Command and Control", "Tactic" AS "Command and Control Tactic" OUTPUT "$Phase0LongName$" AS c11_1 "$Phase1LongName$" AS c11_2 "$Phase2LongName$" AS c11_3 

| eval color="#$Phase0Color$" 
| eval colorby="$colorby$" 
| eval t1='Initial Access' 
| eval t2='Execution' 
| eval t3='Persistence' 
| eval t4='Privilege Escalation' 
| eval t5='Defense Evasion' 
| eval t6='Credential Access'
| eval t7='Discovery' 
| eval t8='Lateral Movement' 
| eval t9='Collection' 
| eval t10='Exfiltration' 
| eval t11='Command and Control' 
| foreach t* [
    | eval text='&lt;&lt;FIELD&gt;&gt;' 
    | eval p0_count=coalesce(c&lt;&lt;MATCHSTR&gt;&gt;_1,0) 
    | eval p1_count=coalesce(c&lt;&lt;MATCHSTR&gt;&gt;_2,0) 
    | eval p2_count=coalesce(c&lt;&lt;MATCHSTR&gt;&gt;_3,0) 
    | eval total_count=p0_count+p1_count+p2_count 
    | eval opacity=tostring(case(
        colorby="$Phase0LongName$",p0_count/10,
        colorby="$Phase1LongName$",p1_count/10,
        colorby="$Phase2LongName$",p2_count/10,
        colorby="Total",total_count/10
        )) 
    | eval tooltip="$Phase0LongName$: ".p0_count."&lt;br /&gt;"."$Phase1LongName$: ".p1_count."&lt;br /&gt;"."$Phase2LongName$: ".p2_count."&lt;br /&gt;"."Total: ".total_count 
    | eval "&lt;&lt;FIELD&gt;&gt;" = if(text!="",mvappend(text,color,opacity,tooltip),null)
] 
| eval "Initial Access"=t1
| eval "Execution"=t2
| eval "Persistence"=t3
| eval "Privilege Escalation"=t4
| eval "Defense Evasion"=t5
| eval "Credential Access"=t6
| eval "Discovery"=t7
| eval "Lateral Movement"=t8
| eval "Collection"=t9
| eval "Exfiltration"=t10
| eval "Command and Control"=t11
| fields - c*_* "* Tactic" p*_* t* text tooltip total_count color* opacity</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="count">35</option>
        <drilldown>
          <eval token="form.MITRE_Technique">replace($click.value2$, ".{0,3}_.{0,3}_.{0,3}_","")</eval>
          <set token="form.highlight">*</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="cs3">
    <panel>
      <title>Content selection</title>
      <input type="dropdown" token="phase">
        <label>Status</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <fieldForLabel>LongName</fieldForLabel>
        <fieldForValue>LongName</fieldForValue>
        <search>
          <query>| inputlookup AppSettings.csv
| rex field=Key "(?&lt;phase&gt;.*)(Long|Short)Name"
| stats first(Value) AS LongName, Last(Value) AS ShortName BY phase
| fields - phase</query>
        </search>
        <change>
          <condition label="Active">
            <set token="deeplink_enabled">Yes</set>
            <set token="deeplink_data_available">Good|Mixed</set>
          </condition>
          <condition label="Available">
            <set token="deeplink_enabled">No</set>
            <set token="deeplink_data_available">Good|Mixed</set>
          </condition>
          <condition label="Needs data">
            <set token="deeplink_enabled">ALL</set>
            <set token="deeplink_data_available">Unknown|Bad</set>
          </condition>
          <condition label="*">
            <set token="deeplink_enabled">ALL</set>
            <set token="deeplink_data_available">ALL</set>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="app">
        <label>Originating app</label>
        <fieldForLabel>App</fieldForLabel>
        <fieldForValue>App</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by App | fields App | sort 0 App</query>
        </search>
        <choice value="*">Any</choice>
        <default>*</default>
        <change>
          <condition label="Any">
            <set token="deeplink_displayapp">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_displayapp">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="MITRE_Tactic">
        <label>MITRE Tactic</label>
        <fieldForLabel>MITRE_Tactic_Label</fieldForLabel>
        <fieldForValue>MITRE Tactic</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by "MITRE Tactic"
| fields "MITRE Tactic"
| eval MITRE_Tactic_Label='MITRE Tactic'
| sort 0 "MITRE_Tactic_Label"</query>
        </search>
        <choice value="*">Any</choice>
        <default>*</default>
        <change>
          <condition label="Any">
            <set token="deeplink_mitre_tactic_display">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_mitre_tactic_display">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="MITRE_Technique">
        <label>MITRE Technique</label>
        <fieldForLabel>MITRE_Technique_Label</fieldForLabel>
        <fieldForValue>MITRE Technique</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by "MITRE Technique"
| fields "MITRE Technique"
| sort 0 "MITRE_Technique_Label"</query>
        </search>
        <choice value="*">Any</choice>
        <default>*</default>
        <change>
          <condition label="Any">
            <set token="deeplink_mitre_technique_display">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_mitre_technique_display">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="datasource">
        <label>Data Source</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>datasource</fieldForLabel>
        <fieldForValue>datasource</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by datasource | fields datasource | sort 0 datasource</query>
        </search>
        <change>
          <condition label="Any">
            <set token="deeplink_datasource">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_datasource">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="datacategory">
        <label>Data Source Category</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>Data Source Category</fieldForLabel>
        <fieldForValue>Data Source Category</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by "Data Source Category" | fields "Data Source Category" | sort 0 "Data Source Category"</query>
        </search>
        <change>
          <condition label="Any">
            <set token="deeplink_data_source_categories_display">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_data_source_categories_display">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="bookmark_status">
        <label>Bookmark Status</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>bookmark_status_display</fieldForLabel>
        <fieldForValue>bookmark_status</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by bookmark_status,bookmark_status_display | fields bookmark_status bookmark_status_display
| sort 0 bookmark_status_display
| dedup bookmark_status</query>
        </search>
        <change>
          <condition label="Any">
            <set token="deeplink_bookmark_status">ALL</set>
          </condition>
          <condition label="*">
            <set token="deeplink_bookmark_status">$value$</set>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="highlight">
        <label>Featured</label>
        <choice value="*">Any</choice>
        <default>Yes</default>
        <initialValue>*</initialValue>
        <fieldForLabel>highlight</fieldForLabel>
        <fieldForValue>highlight</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by highlight | fields highlight | sort 0 highlight</query>
        </search>
        <change>
          <condition label="Yes">
            <set token="deeplink_highlight">Yes</set>
          </condition>
          <condition label="Any">
            <set token="deeplink_highlight">ALL</set>
          </condition>
          <condition label="*">
            <set token="deeplink_highlight">$value$</set>
          </condition>
        </change>
      </input>
      <input type="text" token="searchfilter">
        <label>Search Filter</label>
        <default></default>
        <change>
          <condition value="*">
            <set token="deeplink_search">$value$</set>
          </condition>
        </change>
      </input>
    </panel>
  </row>
  <row id="tabs_content_table">
    <panel>
      <html>
      <h1 data-translate-id="contentanalytics-h1-sectiontwo">2. Selected Content</h1>
      <p data-translate-id="contentanalytics-p-sectiontwodescription">Use the drop downs or tables to further filter your selection. </p>
      <ul id="tabs" class="nav nav-tabs">
                    <li class="active">
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row2_col1,row1_col1" data-token="row2_col1" data-translate-id="contentanalytics-li-selection">Selection</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row2_col2,row1_col1" data-token="row2_col2" data-translate-id="contentanalytics-li-contentlist">Content list</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row2_col3,row1_col1" data-token="row2_col3" data-translate-id="contentanalytics-li-datasource">Selection by Data Source</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row2_col4,row1_col1" data-token="row2_col4" data-translate-id="contentanalytics-li-datasourcecategory">Selection by Data Source Category</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row2_col5,row1_col1" data-token="row2_col5" data-translate-id="contentanalytics-li-mitretactic">Selection by MITRE Tactic</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row2_col6,row1_col1" data-token="row2_col6" data-translate-id="contentanalytics-li-mitretechnique">Selection by MITRE Technique</a>
                    </li>
				</ul>
    </html>
    </panel>
  </row>
  <row id="row2_col1">
    <panel>
      <title></title>
      <single>
        <title>Total Selected</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| stats
count</query>
        </search>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
    <panel>
      <chart>
        <title>Selection by Status</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "Data Source"
| where 'Data Source'!="-"
| stats
count by Status</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="form.phase">$row.Status$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row id="row2_col2">
    <panel>
      <table id="content_table">
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| sort Journey
| eval "Use Case"='Use Case Orig',"Bookmark Status"=bookmark_status_display, Featured=highlight, "Data Availability"=data_available,Enabled=enabled,"Data Coverage"=data_available_numeric
| table Journey Status Title Description "Data Source" "Data Source Category" "Use Case" "MITRE Tactic" "MITRE Technique" App "Bookmark Status" Featured Enabled "Data Availability" "Data Coverage" deeplink</query>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#1836DE" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Active">
          <colorPalette type="list">[#1836DE]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="Available">
          <colorPalette type="minMidMax" maxColor="#0D6AEB" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Needs data">
          <colorPalette type="minMidMax" maxColor="#00A9F8" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Selected">
          <colorPalette type="minMidMax" maxColor="#F1C40F" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Selected">
          <colorPalette type="minMidMax" maxColor="#F1C40F" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Status">
          <colorPalette type="map">{"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row id="row2_col3">
    <panel>
      <table id="datasource_table">
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "Data Source"
| where 'Data Source'!="-"
| stats
sum(eval(if(Status="$Phase0LongName$",1,0))) AS $Phase0LongName$,
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
sum(eval(if(Status="$SelectedLongName$",1,0))) AS "$SelectedLongName$"
BY "Data Source"

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| sort - Total
| table "Data Source" Total "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#$Phase0Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase0LongName$">
          <colorPalette type="list">[#$Phase0Color$]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="$Phase1LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase1Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase2LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase2Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedLongName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedShortName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <set token="form.datasource">$row.Data Source$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="row2_col4">
    <panel>
      <table id="datacategory_table">
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "Data Source Category"
| where 'Data Source Category'!="-"
| stats
sum(eval(if(Status="$Phase0LongName$",1,0))) AS $Phase0LongName$,
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
sum(eval(if(Status="$SelectedLongName$",1,0))) AS "$SelectedLongName$"
BY "Data Source Category"

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| sort - Total
| table "Data Source Category" Total "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#$Phase0Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase0LongName$">
          <colorPalette type="list">[#$Phase0Color$]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="$Phase1LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase1Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase2LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase2Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedLongName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedShortName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <set token="form.datacategory">$row.Data Source Category$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="row2_col5">
    <panel>
      <table id="usecase_table">
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "MITRE Tactic"
| stats
sum(eval(if(Status="$Phase0LongName$",1,0))) AS $Phase0LongName$,
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
sum(eval(if(Status="$SelectedLongName$",1,0))) AS "$SelectedLongName$"
BY "MITRE Tactic"

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| sort - Total
| table "MITRE Tactic" Total "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#$Phase0Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase0LongName$">
          <colorPalette type="list">[#$Phase0Color$]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="$Phase1LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase1Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase2LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase2Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedLongName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedShortName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <set token="form.MITRE_Tactic">$row.MITRE Tactic$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="row2_col6">
    <panel>
      <table id="journey_table">
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "MITRE Technique"
| where 'MITRE Technique'!=""
| stats
sum(eval(if(Status="$Phase0LongName$",1,0))) AS $Phase0LongName$,
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
sum(eval(if(Status="$SelectedLongName$",1,0))) AS "$SelectedLongName$"
BY "MITRE Technique"

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| sort - Total
| table "MITRE Technique" Total "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#$Phase0Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase0LongName$">
          <colorPalette type="list">[#$Phase0Color$]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="$Phase1LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase1Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase2LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase2Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedLongName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedShortName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <set token="form.MITRE_Technique">$row.MITRE Technique$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
          <h1 data-translate-id="contentanalytics-h1-sectionthree">3. View Content</h1>
      <p data-translate-id="contentanalytics-h1-sectionthreedescription">Click the button below to drill down in to the content. </p>
       <a class="btn btn-primary animatedbutton" target="_blank" role="button" data-unset-token="show_details" href="/app/Splunk_Security_Essentials/contents#mitre_technique_display=$deeplink_mitre_technique_display$&amp;mitre_tactic_display=$deeplink_mitre_tactic_display$&amp;highlight=$deeplink_highlight$&amp;bookmark_status=$deeplink_bookmark_status$&amp;displayapp=$deeplink_displayapp$&amp;datasource=$deeplink_datasource$&amp;data_source_categories_display=$deeplink_data_source_categories_display$&amp;enabled=$deeplink_enabled$&amp;data_available=$deeplink_data_available$&amp;search=$deeplink_search$">
          <span data-translate-id="contentanalytics-span-drilldowntosse">Drill down to content selection</span>
        </a>
    </html>
    </panel>
  </row>
</form>